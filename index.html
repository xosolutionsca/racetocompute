<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ðŸ’» Computer Racing</title>
  <style>
    html,body{margin:0;height:100%;background:#0e0e13;color:#f0f0f0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    #ui{position:fixed;top:0;left:0;right:0;padding:10px 12px;display:flex;flex-direction:column;gap:6px;pointer-events:none;z-index:2}
    #title{font-weight:800;letter-spacing:.4px}
    #hud{display:flex;gap:18px;font-weight:600}
    #help{font-size:12px;opacity:.85}
    #game{display:block;width:100vw;height:100vh}
    #overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:grid;place-items:center;font-size:24px;font-weight:800;z-index:3}
    .hide{display:none!important}
  </style>
</head>
<body>
  <div id="ui">
    <div id="title">ðŸ’» Computer Racing</div>
    <div id="hud">
      <span id="pos">Position: 1/4</span>
      <span id="dist">Distance: 0%</span>
      <span id="battery">Battery: 100%</span>
      <span id="speed">Speed: 0</span>
    </div>
    <div id="help">Up/Down: change lane Â· Space: boost Â· P: pause Â· R: restart</div>
  </div>
  <canvas id="game"></canvas>
  <div id="overlay" class="hide"></div>

  <script>
    (function () {
      const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
      const ui={pos:document.getElementById("pos"),dist:document.getElementById("dist"),
                battery:document.getElementById("battery"),speed:document.getElementById("speed"),
                overlay:document.getElementById("overlay")};
      function resize(){const dpr=Math.max(1,Math.floor(window.devicePixelRatio||1));
        canvas.width=Math.floor(window.innerWidth*dpr);canvas.height=Math.floor(window.innerHeight*dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);W=window.innerWidth;H=window.innerHeight}
      window.addEventListener("resize",resize);let W=window.innerWidth,H=window.innerHeight;resize();

      const input={up:false,down:false,boost:false,pause:false};
      window.addEventListener("keydown",e=>{if(e.repeat)return;
        if(e.key==="ArrowUp"||e.key==="w"||e.key==="W")input.up=true;
        if(e.key==="ArrowDown"||e.key==="s"||e.key==="S")input.down=true;
        if(e.key===" ")input.boost=true;
        if(e.key==="p"||e.key==="P"){input.pause=!input.pause;togglePause(input.pause)}})
      window.addEventListener("keyup",e=>{if(e.key==="ArrowUp"||e.key==="w"||e.key==="W")input.up=false;
        if(e.key==="ArrowDown"||e.key==="s"||e.key==="S")input.down=false;
        if(e.key===" ")input.boost=false})
      function togglePause(p){ui.overlay.classList.toggle("hide",!p);
        if(p)ui.overlay.textContent="Paused â€” press P to resume"}

      const lanes=5; const laneHeight=()=>Math.min(120,Math.max(60,Math.floor(H/(lanes+1))));
      const laneY=i=>Math.floor((H-lanes*laneHeight())/2+i*laneHeight()+laneHeight()/2);
      const FINISH=2800; let cameraX=0;

      function makeComputer(color,name,isPlayer=false,lane=2){return{
        name,isPlayer,x:0,y:laneY(lane),lane,w:70,h:48,baseSpeed:isPlayer?240:(200+Math.random()*80),
        speed:0,color,battery:100,ai:{targetSpeed:220+Math.random()*120,laneChangeCooldown:0},
        finished:false,finishTime:Infinity};}
      const racers=[makeComputer("#a8d8ff","You",true,2),
                    makeComputer("#ffd8a8","AI-1",false,1),
                    makeComputer("#d8ffa8","AI-2",false,3),
                    makeComputer("#f8a8ff","AI-3",false,4)];

      const features=[]; function addFeature(type,x,lane){features.push({type,x,lane});}
      for(let i=6;i<FINISH;i+=300){ if(Math.random()<0.6)addFeature("boost",i+(Math.random()*120-60),Math.floor(Math.random()*lanes));
        if(Math.random()<0.45)addFeature("slow",i+120+(Math.random()*120-60),Math.floor(Math.random()*lanes)); }

      function drawTrack(){ctx.fillStyle="#141820";ctx.fillRect(0,0,W,H);
        for(let i=0;i<lanes;i++){const y=laneY(i);ctx.strokeStyle="rgba(255,255,255,0.2)";
          ctx.setLineDash([16,16]);ctx.beginPath();ctx.moveTo(-1000-cameraX,y+laneHeight()/2);
          ctx.lineTo(FINISH+1000-cameraX,y+laneHeight()/2);ctx.stroke();ctx.setLineDash([]);}
        const fx=FINISH-cameraX;ctx.fillStyle="#ffffff";
        for(let i=0;i<10;i++){ctx.fillRect(fx,i*laneHeight()/2,18,laneHeight()/4*(i%2?1:0.6));}
        ctx.fillText("FINISH",fx+26,laneY(0)-laneHeight()/1.5);}

      function drawFeature(f){const x=f.x-cameraX,y=laneY(f.lane);
        if(x<-100||x>W+100)return;
        if(f.type==="boost"){ctx.fillStyle="#b3ecff";ctx.fillRect(x-12,y-10,24,20);}
        else{ctx.fillStyle="#ffb3b3";ctx.beginPath();ctx.arc(x,y,12,0,Math.PI*2);ctx.fill();}}

      function drawComputer(r){const x=r.x-cameraX,y=laneY(r.lane);
        ctx.fillStyle=r.color;ctx.fillRect(x-r.w/2,y-r.h/2,r.w,r.h);
        ctx.strokeStyle="#1e1e1e";ctx.lineWidth=3;ctx.strokeRect(x-r.w/2,y-r.h/2,r.w,r.h);
        ctx.fillStyle="#cfcfcf";ctx.fillRect(x-10,y+r.h/2-2,20,10);ctx.fillRect(x-26,y+r.h/2+8,52,8);
        ctx.fillStyle="rgba(255,255,255,.85)";ctx.font="12px sans-serif";ctx.fillText(r.name,x-r.w/2,y-r.h/2-6);}

      function collideFeatures(r){for(const f of features){if(f.lane!==r.lane)continue;
        if(Math.abs(r.x-f.x)<30){if(f.type==="boost"){r.speed+=80;if(r.isPlayer)r.battery=Math.min(100,r.battery+10);}
          else{r.speed=Math.max(80,r.speed-120);}}}}

      function updatePlayer(r,dt){if(input.up&&r.lane>0){r.lane--;input.up=false;}
        if(input.down&&r.lane<lanes-1){r.lane++;input.down=false;}
        const target=r.baseSpeed+(input.boost&&r.battery>0?150:0);
        r.speed+=(target-r.speed)*6*dt;
        if(input.boost&&r.battery>0)r.battery=Math.max(0,r.battery-25*dt);
        else r.battery=Math.min(100,r.battery+12*dt);
        r.x+=r.speed*dt;collideFeatures(r)}

      function updateAI(r,dt){r.ai.laneChangeCooldown-=dt;
        const ahead=features.find(f=>f.lane===r.lane&&f.x>r.x&&f.x-r.x<140);
        if(r.ai.laneChangeCooldown<=0&&ahead&&Math.random()<0.5){
          let best=r.lane;for(let dl of[-1,1]){const L=r.lane+dl;if(L<0||L>=lanes)continue;
            const near=features.find(f=>f.lane===L&&Math.abs(f.x-r.x)<160);
            if(ahead.type==="slow"&&(!near||near.type==="boost"))best=L;
            if(ahead.type==="boost"&&near&&near.type==="boost")best=L;}
          r.lane=best;r.ai.laneChangeCooldown=.7+Math.random()*.9;}
        const target=Math.min(360,r.ai.targetSpeed+(Math.random()<.15?80:0));
        r.speed+=(target-r.speed)*4*dt;r.x+=r.speed*dt;collideFeatures(r)}

      function standings(){return[...racers].sort((a,b)=>b.x-a.x);}
      function updateUI(player){const rank=standings().findIndex(r=>r===player)+1;
        ui.pos.textContent=`Position: ${rank}/${racers.length}`;
        const pct=Math.max(0,Math.min(100,Math.floor(player.x/FINISH*100)));
        ui.dist.textContent=`Distance: ${pct}%`;
        ui.battery.textContent=`Battery: ${Math.floor(player.battery)}%`;
        ui.speed.textContent=`Speed: ${Math.floor(player.speed)}`;}
      function checkFinish(r,t){if(!r.finished&&r.x>=FINISH){r.finished=true;r.finishTime=t;}}

      let last=performance.now(),raceOver=false;
      function loop(now){const dt=Math.min(.033,(now-last)/1000); last=now;
        if(!input.pause&&!raceOver){for(const r of racers){if(r.isPlayer)updatePlayer(r,dt);else updateAI(r,dt);checkFinish(r,now);}
          const player=racers[0]; cameraX+=((player.x-W*.3)-cameraX)*3*dt;
          if(racers.every(r=>r.finished)){raceOver=true;
            const sorted=standings(); const playerRank=sorted.findIndex(r=>r.isPlayer)+1;
            ui.overlay.classList.remove("hide"); ui.overlay.textContent=`Finish! You placed ${playerRank}/${racers.length}. Press R to race again.`;}
          updateUI(player);}
        ctx.clearRect(0,0,W,H); drawTrack(); for(const f of features)drawFeature(f);
        for(const r of standings().reverse())drawComputer(r); requestAnimationFrame(loop);}
      requestAnimationFrame(loop);
      window.addEventListener("keydown",e=>{if(e.key==="r"||e.key==="R")window.location.reload();});
    })();
  </script>
</body>
</html>
